<html>
<head>
	<title>BCA Field Day</title>
	<link rel="stylesheet" type="text/css" href="/static/style.css">
	<script type="text/javascript" src="/static/canvasjs.min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script type="text/javascript">


  window.onload = function () {

    CanvasJS.addColorSet("teamColors",
                [//colorSet Array

                "#2159D6",
                "#21AA29",
                "#D62408",
                "#FFCF00"             
                ]);
    // initial values of dataPoints
    var dps = [
    {label: "BLUE", y: {{blue}}},
    {label: "GREEN", y: {{green}}},
    {label: "RED", y: {{red}}},
    {label: "YELLOW", y: {{yellow}}},
    ];
    //var totalPoints = "TOTAL POINTS ACCUMULATED BY ALL TEAMS: 0";

    var chart = new CanvasJS.Chart("chartContainer",{
      backgroundColor: "F3F3F3",
      colorSet: "teamColors",
      theme:  "theme1",
      title:{ 
        text: ""
      },
      axisY: {        
        title: "NUMBER OF POINTS"
      },          
      legend:{
        verticalAlign: "top",
        horizontalAlign: "centre",
        fontSize: 18

      },
      data : [{
        type: "column",
        showInLegend: false,
        legendMarkerType: "none",       
        indexLabel: "{y}",
        dataPoints: dps
      }]
    });

    // renders initial chart
    chart.render();

    var sum = 590;   //initial sum 

    var updateInterval = 1500;  // milliseconds

    var updateChart = function () {
      $('#tableContainer').fadeOut('fast');
      // Selecting a random dataPoint
      //var dataPointIndex = Math.round(Math.random()*3);   
      //var dataPointIndex = 0;
      // generating random value
      //var deltaY = Math.random()*100;

      $.getJSON('/scores', {

      }, function(data) {
        blue = data.blue;
        green = data.green;
        red = data.red;
        yellow = data.yellow;
      });

      // adding random value to random dataPoint
      dps[0].y = blue;
      dps[1].y = green;
      dps[2].y = red;
      dps[3].y = yellow;
  $( "#tableContainer" ).html("<table><tr><td> Event Name </td> <td> Points </td> <td> Team </td> </tr> {% for event in events %} <tr> <td> {{ event['event'] }} </td> <td> {{ event['points'] }} </td> <td> {{ event['team'] }} </td> </tr> {% endfor %} </table>")
      chart.render();
      // updating legend text. 
      //sum = sum + deltaY;
      //totalEmployees = "TOTAL POINTS ACCUMULATED BY ALL TEAMS: " + sum;      
      //chart.options.data[0].legendText = totalPoints;  
      $('#tableContainer').fadeIn('fast');

      chart.render();
    };
      // update chart after specified interval
      setInterval(function(){updateChart()}, updateInterval);

    };
    </script>
  </head>
  <body>
    <div id="container">
      <div id="top">
        <h1>BCA <strong>FIELD DAY</strong></h1>
        <h2>Developed by Kenneth Rhee</h2>
        <div id="chartContainer" style="height:300px; width:95%; margin: 0 auto;">
        </div>
      </div>
      <div id="bottom">
        <div id="tableContainer">
          <table>
            <tr>
              <td> Event Name </td>
              <td> Points </td>
              <td> Team </td>
            </tr>
            {% for event in events %}
            <tr>
              <td> {{ event['event'] }} </td>
              <td> {{ event['points'] }} </td>
              <td> {{ event['team'] }} </td>
            </tr>
            {% endfor %}
          </table>
        </div>
      </div>
    </div>
  </body>
  </html>